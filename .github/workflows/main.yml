name: 🚀 Deploy website on push
on:
  push:

jobs:
  web-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Download repo as ZIP (no git, no submodules)
        run: |
          set -e
          curl -sSL \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github+json" \
            -o repo.zip \
            "https://api.github.com/repos/${{ github.repository }}/zipball/${{ github.sha }}"
          unzip -q repo.zip
          topdir="$(ls -d */ | head -n 1)"
          # on garde uniquement le front
          rm -rf QuaiAntiqueRestaurantFront
          mv "$topdir/QuaiAntiqueRestaurantFront" ./QuaiAntiqueRestaurantFront
          rm -rf "$topdir" repo.zip
          echo "Front content:"
          ls -la QuaiAntiqueRestaurantFront || true

      - name: 🟢 Setup Node (if package.json exists)
        if: ${{ hashFiles('QuaiAntiqueRestaurantFront/package.json') != '' }}
        uses: actions/setup-node@v5
        with:
          node-version: 20

      - name: 📦 Install npm dependencies
        if: ${{ hashFiles('QuaiAntiqueRestaurantFront/package.json') != '' }}
        run: |
          cd QuaiAntiqueRestaurantFront
          if [ -f package-lock.json ]; then
            npm ci
          else
            npm install
          fi

      - name: 🏗️ Build (optional)
        if: ${{ hashFiles('QuaiAntiqueRestaurantFront/package.json') != '' }}
        run: |
          cd QuaiAnti
